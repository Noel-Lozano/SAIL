{% extends "layout.html" %}

{% block title %}Profile - TravelBot{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
<style>
    /* Profile-specific styles that extend the base styles.css */
    .profile-container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        overflow: hidden;
    }

    .profile-header {
        background: linear-gradient(135deg, #0C318C, #1e46aa);
        color: white;
        padding: 40px 30px;
        text-align: center;
        position: relative;
    }

    .profile-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
        opacity: 0.3;
    }

    .profile-avatar {
        width: 120px;
        height: 120px;
        background: rgba(255,255,255,0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        font-size: 48px;
        color: white;
        position: relative;
        z-index: 1;
        border: 4px solid rgba(255,255,255,0.3);
    }

    .profile-title {
        font-size: 32px;
        font-weight: 700;
        margin-bottom: 10px;
        position: relative;
        z-index: 1;
    }

    .profile-subtitle {
        font-size: 16px;
        opacity: 0.9;
        position: relative;
        z-index: 1;
    }

    .profile-content {
        padding: 40px 30px;
    }

    .profile-section {
        margin-bottom: 40px;
        padding-bottom: 30px;
        border-bottom: 1px solid #eee;
    }

    .profile-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
    }

    .section-title {
        font-size: 20px;
        font-weight: 600;
        color: #0C318C;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .section-icon {
        width: 24px;
        height: 24px;
        background: #0C318C;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 12px;
    }

    .form-group {
        margin-bottom: 25px;
    }

    .form-label {
        font-weight: 600;
        color: #333;
        margin-bottom: 8px;
        display: block;
    }

    .form-control {
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        padding: 12px 16px;
        transition: all 0.3s ease;
        font-size: 16px;
        width: 100%;
    }

    .form-control:focus {
        border-color: #0C318C;
        box-shadow: 0 0 0 0.2rem rgba(12, 49, 140, 0.1);
        outline: none;
    }

    .interests-textarea {
        min-height: 120px;
        resize: vertical;
    }

    .interests-hint {
        font-size: 14px;
        color: #666;
        margin-top: 8px;
        font-style: italic;
    }

    .ai-toggle-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        border: 2px solid #e0e0e0;
        margin-top: 20px;
    }

    .toggle-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 15px;
    }

    .toggle-label {
        font-weight: 600;
        color: #333;
        margin: 0;
    }

    .toggle-switch {
        position: relative;
        width: 60px;
        height: 30px;
        background: #ccc;
        border-radius: 15px;
        cursor: pointer;
        transition: background 0.3s ease;
    }

    .toggle-switch.active {
        background: #0C318C;
    }

    .toggle-switch::after {
        content: '';
        position: absolute;
        width: 26px;
        height: 26px;
        background: white;
        border-radius: 50%;
        top: 2px;
        left: 2px;
        transition: transform 0.3s ease;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .toggle-switch.active::after {
        transform: translateX(30px);
    }

    .toggle-description {
        font-size: 14px;
        color: #666;
        line-height: 1.5;
    }

    .btn-update {
        background: linear-gradient(135deg, #0C318C, #1e46aa);
        border: none;
        padding: 12px 30px;
        border-radius: 8px;
        color: white;
        font-weight: 600;
        font-size: 16px;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .btn-update:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(12, 49, 140, 0.3);
        color: white;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    .stat-card {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
        border: 2px solid #e0e0e0;
        transition: all 0.3s ease;
    }

    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        border-color: #0C318C;
    }

    .stat-number {
        font-size: 28px;
        font-weight: 700;
        color: #0C318C;
        margin-bottom: 5px;
    }

    .stat-label {
        font-size: 14px;
        color: #666;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    @media (max-width: 768px) {
        .profile-container {
            margin: 20px;
        }
        
        .profile-header {
            padding: 30px 20px;
        }
        
        .profile-content {
            padding: 30px 20px;
        }
        
        .profile-title {
            font-size: 24px;
        }
        
        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .toggle-container {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }
    }
</style>

<div class="profile-container">
    <!-- Back Link -->
    <div style="padding: 20px 30px 0;">
        <a href="{{ url_for('index') }}" class="back-link">
            ‚Üê Back to Search
        </a>
    </div>

    <!-- Profile Header -->
    <div class="profile-header">
        <div class="profile-avatar">
            üë§
        </div>
        <h1 class="profile-title" id="display-username">{{ session['user'] }}</h1>
        <p class="profile-subtitle">Travel Enthusiast & Explorer</p>
    </div>

    <!-- Profile Content -->
    <div class="profile-content">
        <form id="profile-form" method="POST" action="{{ url_for('profile.profile') }}">
            <!-- Username Section -->
            <div class="profile-section">
                <h2 class="section-title">
                    <span class="section-icon">üë§</span>
                    Account Information
                </h2>
                
                <div class="form-group">
                    <label class="form-label" for="username">Username</label>
                    <input type="text" class="form-control" id="username" name="username" value="{{ session['user'] }}" required>
                </div>

                <!-- User Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">{{ user_stats.saved_places or 0 }}</div>
                        <div class="stat-label">Saved Places</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ user_stats.cities_visited or 0 }}</div>
                        <div class="stat-label">Cities Visited</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ user_stats.trip_plans or 0 }}</div>
                        <div class="stat-label">Trip Plans</div>
                    </div>
                </div>
            </div>

            <!-- Interests Section -->
            <div class="profile-section">
                <h2 class="section-title">
                    <span class="section-icon">üéØ</span>
                    Travel Interests & Preferences
                </h2>
                
                <div class="form-group">
                    <label class="form-label" for="interests">Your Travel Interests</label>
                    <textarea class="form-control interests-textarea" id="interests" name="interests" placeholder="Tell us about your travel preferences, favorite activities, cuisine types, accommodation styles, budget range, and anything else that would help us personalize your travel recommendations...">{{ user_profile.interests or '' }}</textarea>
                    <div class="interests-hint">
                        üí° These interests will help our AI generate more personalized travel recommendations for you. Include details about activities you enjoy, types of destinations you prefer, budget considerations, accommodation preferences, and any special interests.
                    </div>
                </div>

                <!-- AI Integration Toggle -->
                <div class="ai-toggle-section">
                    <div class="toggle-container">
                        <label class="toggle-label">Use interests for AI recommendations</label>
                        <div class="toggle-switch {{ 'active' if user_profile.ai_enabled else '' }}" id="ai-toggle"></div>
                        <input type="hidden" name="ai_enabled" id="ai-enabled-input" value="{{ 'true' if user_profile.ai_enabled else 'false' }}">
                    </div>
                    <p class="toggle-description">
                        When enabled, your interests will be included in AI-generated travel suggestions to provide more personalized recommendations tailored to your preferences.
                    </p>
                </div>
            </div>

            <!-- Save Button -->
            <div class="text-center">
                <button type="submit" class="btn btn-update">
                    Update Profile
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    // Toggle switch functionality
    const toggle = document.getElementById('ai-toggle');
    const aiEnabledInput = document.getElementById('ai-enabled-input');
    let aiEnabled = {{ 'true' if user_profile.ai_enabled else 'false' }};

    toggle.addEventListener('click', function() {
        aiEnabled = !aiEnabled;
        if (aiEnabled) {
            toggle.classList.add('active');
            aiEnabledInput.value = 'true';
        } else {
            toggle.classList.remove('active');
            aiEnabledInput.value = 'false';
        }
    });

    // Form submission
    document.getElementById('profile-form').addEventListener('submit', function(e) {
        // Let the form submit normally to Flask backend
        const username = document.getElementById('username').value;
        
        // Update display username immediately for better UX
        document.getElementById('display-username').textContent = username;
    });

    // Character counter for interests textarea
    const interestsTextarea = document.getElementById('interests');
    const hint = document.querySelector('.interests-hint');

    function updateCharacterCount() {
        const count = interestsTextarea.value.length;
        const words = interestsTextarea.value.trim().split(/\s+/).filter(word => word.length > 0).length;
        
        if (count > 0) {
            hint.innerHTML = `üí° ${count} characters, ${words} words. These interests will help our AI generate more personalized travel recommendations for you.`;
        } else {
            hint.innerHTML = 'üí° These interests will help our AI generate more personalized travel recommendations for you. Include details about activities you enjoy, types of destinations you prefer, budget considerations, accommodation preferences, and any special interests.';
        }
    }

    interestsTextarea.addEventListener('input', updateCharacterCount);
    updateCharacterCount(); // Initial count
</script>

{% endblock %}